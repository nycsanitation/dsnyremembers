const capitalize=s=>(s=s.toLowerCase()).split(/[\s_]+/).map(w=>w.charAt(0).toUpperCase()+w.substring(1)).join(" "),onEachSector=(feature,layer)=>{const prop="sector";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng)),highlightFeature(e)},popupclose:e=>{polygonLayerGroup.eachLayer(layer=>{layer.resetStyle()})}}),layer.bindTooltip(feature.properties.sector.toLocaleString(),{direction:"center",permanent:!0,className:"tooltip-custom-cl"})},onEachPort=(feature,layer)=>{const prop="port";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng))}})},onEachBargeRoute=(feature,layer)=>{const prop="origin";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng))}})},onEachTruckRoute=(feature,layer)=>{const prop="destination";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng))}})},onEachBuilding=(feature,layer)=>{const prop="building";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng)),highlightFeature(e)},popupclose:e=>{polygonLayerGroup.eachLayer(layer=>{layer.resetStyle()})}})},onEachArea=(feature,layer)=>{layer.bindTooltip(feature.properties.location.toLocaleString(),{direction:"right",permanent:!0,className:"tooltip-custom-fk"})},onEachVideo=(feature,layer)=>{const prop="title";layer.on({click:e=>{e.target.getPopup()?e.target.closePopup():(createPopup(e,prop),e.target.openPopup(e.latlng))}})},createPopup=(e,prop)=>{const target=e.target,feature=target.feature,key=["port","building"].includes(prop)?"name":prop,property=feature.properties[key],attribute=capitalize(key),popupContent=null!==property?[`<h6><strong>${attribute}:</strong><br>${property}</h6>`]:[];if("sector"===prop){const area=Math.round(100*feature.properties.area)/100;popupContent.push(`<h6><strong>Area:</strong><br>${area} acres</h6>`)}else if("port"===prop){const tons=Math.round(feature.properties.total_ton).toLocaleString("en");popupContent.push(`<h6><strong>Debris Tonnage:</strong><br>${tons} tons</h6>`)}else if(["origin","destination"].includes(prop)){const dist=(Math.round(100*feature.properties.length)/100).toLocaleString("en");popupContent.push(`<h6><strong>Distance:</strong><br>${dist} miles</h6>`)}else if("building"===prop){const damage=feature.properties.damage;popupContent.push(`<h6><strong>Damage:</strong><br>${damage}</h6>`)}else if("title"===prop){const link=feature.properties.link,text="/"+link.split("/").slice(1,3).join("/");popupContent.push(`<h6><strong>Video Link:</strong><br><a href="${text}" target="_blank">${text}</a></h6>`)}popupHTML=popupContent.join(""),target.bindPopup(popupHTML,{maxWidth:150,className:"popup-custom"})},highlightFeature=e=>{const target=e.target;polygonLayerGroup.eachLayer(layer=>{layer.resetStyle()}),target.setStyle(myStyle.highlight)};